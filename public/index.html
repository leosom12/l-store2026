<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1e293b">
    <meta name="description" content="Sistema PDV para Supermercado">
    <title>L-STORE - Sistema de Ponto de Venda</title>

    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <!-- PWA -->
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" type="image/png" href="/icon-192.png">
    <link rel="apple-touch-icon" href="/icon-512.png">
    <link rel="stylesheet" href="styles.css?v=6.0.0">

</head>

<body>
    <div id="notification-container"></div>
    <!-- ========== TELA DE LOGIN/REGISTRO (EMPRESAS) ========== -->
    <div id="auth-screen" class="screen">
        <div class="auth-container">
            <div class="auth-header">
                <h1><i class="ph ph-shopping-cart"></i> L-STORE</h1>
                <p>Sistema de Ponto de Venda</p>
            </div>

            <!-- Formulário de Login -->
            <div id="login-form" class="auth-form">
                <h2>Entrar</h2>
                <form onsubmit="login(event)">
                    <div class="form-group">
                        <label><i class="ph ph-envelope"></i> Email</label>
                        <input type="email" id="login-email" required placeholder="seu@email.com">
                    </div>
                    <div class="form-group">
                        <label><i class="ph ph-lock-key"></i> Senha</label>
                        <input type="password" id="login-password" required placeholder="••••••••">
                    </div>
                    <button type="submit" class="btn-primary">Entrar</button>
                </form>
                <p class="auth-switch">
                    Não tem conta? <a href="#" onclick="showRegister(); return false;">Cadastre-se</a>
                </p>
            </div>

            <!-- Formulário de Registro -->
            <div id="register-form" class="auth-form" style="display: none;">
                <h2>Criar Conta</h2>
                <p class="auth-subtitle"
                    style="color: var(--accent-orange); text-align: center; margin-bottom: 1rem; font-size: 0.9rem;">
                    <i class="ph ph-warning"></i> Cadastro exclusivo para CNPJ
                </p>
                <form onsubmit="register(event)">
                    <div class="form-group">
                        <label><i class="ph ph-buildings"></i> Razão Social</label>
                        <input type="text" id="register-username" required placeholder="Nome da Empresa">
                    </div>
                    <div class="form-group">
                        <label><i class="ph ph-lock-key"></i> PIN (4 dígitos)</label>
                        <input type="password" id="register-pin" required placeholder="1234" pattern="\d{4}"
                            maxlength="4" inputmode="numeric" title="Digite 4 números">
                    </div>
                    <div class="form-group">
                        <label><i class="ph ph-identification-card"></i> CNPJ</label>
                        <input type="text" id="register-cpf" required placeholder="00.000.000/0000-00" maxlength="18">
                    </div>
                    <div class="form-group">
                        <label><i class="ph ph-envelope"></i> Email</label>
                        <input type="email" id="register-email" required placeholder="empresa@email.com">
                    </div>
                    <div class="form-group">
                        <label><i class="ph ph-lock-key"></i> Senha</label>
                        <input type="password" id="register-password" required placeholder="••••••••" minlength="6">
                    </div>
                    <button type="submit" class="btn-primary">Cadastrar</button>
                </form>
                <p class="auth-switch">
                    Já tem conta? <a href="#" onclick="showLogin(); return false;">Fazer login</a>
                </p>
            </div>

            <!-- Rodapé com Botões e Indicador de Servidor -->
            <div class="auth-footer">
                <!-- Botão Clientes -->
                <button class="btn-secondary"
                    style="width: 100%; display: flex; align-items: center; justify-content: center; gap: 0.5rem;"
                    onclick="showClientLogin()">
                    <i class="ph ph-storefront"></i> L-STORE
                </button>

                <!-- Botão Baixar App -->
                <button id="btn-install-pwa" class="btn-secondary"
                    style="width: 100%; display: none; align-items: center; justify-content: center; gap: 0.5rem;"
                    onclick="installPWA()">
                    <i class="ph ph-download-simple"></i> Baixar App
                </button>

                <!-- Indicador de Servidor -->
                <div id="server-status" class="server-status">
                    <span class="status-dot"></span>
                    <span class="status-text">Verificando servidor...</span>
                </div>

                <!-- Créditos do Desenvolvedor -->
                <div class="dev-credits"
                    style="margin-top: 1.5rem; border-top: 1px solid var(--border-glass); padding-top: 1rem; text-align: center; font-size: 0.8rem; color: var(--text-secondary);">
                    <div
                        style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-bottom: 0.3rem;">
                        <i class="ph ph-code"></i> <span>Desenvolvedor: Leonardo</span>
                    </div>
                    <div
                        style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-bottom: 0.3rem;">
                        <i class="ph ph-envelope-simple"></i> <span>djleocv.hotmail.com@gmail.com</span>
                    </div>
                    <div style="font-weight: bold; color: var(--accent-cyan);">
                        Versão: <span id="app-version">6.0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== TELA DE LOGIN PARA CLIENTES ========== -->
    <div id="client-login-screen" class="screen" style="display: none;">
        <div class="auth-container">
            <div class="auth-header">
                <h1><i class="ph ph-storefront"></i> L-STORE</h1>
                <p>Cadastro e Acesso com PIN</p>
            </div>

            <!-- Formulário de Cadastro do Cliente (REMOVIDO) -->

            <!-- Formulário de Login do Cliente (Nome + PIN) -->
            <div id="client-login-form" class="auth-form">
                <h2>Login Cliente</h2>
                <form onsubmit="loginClient(event)">
                    <div class="form-group">
                        <label><i class="ph ph-user"></i> Seu Nome (Apelido)</label>
                        <input type="text" id="client-login-name" required placeholder="Crie um nome para você"
                            autocomplete="off">
                    </div>
                    <div class="form-group">
                        <label><i class="ph ph-storefront"></i> PIN do Vendedor (Loja)</label>
                        <input type="password" id="client-login-pin" required placeholder="PIN da loja" pattern="\d+"
                            inputmode="numeric" autocomplete="off">
                    </div>
                    <button type="submit" class="btn-primary">Entrar</button>
                </form>
            </div>

            <!-- Rodapé com Voltar -->
            <div class="auth-footer">
                <button class="btn-secondary" style="width: 100%;" onclick="backToMainLogin()">
                    <i class="ph ph-arrow-left"></i> Voltar para login principal
                </button>
            </div>
        </div>
    </div>

    <!-- ========== TELA DA LOJA ONLINE (CLIENTES) ========== -->
    <div id="client-store-screen" class="screen" style="display: none;">
        <div class="store-container">
            <!-- Header with Search -->
            <div class="store-header">
                <div id="store-header-title"
                    style="color: white; font-weight: 800; font-size: 1.2rem; display: flex; align-items: center; gap: 0.5rem;">
                    <i class="ph ph-storefront"></i> L-STORE
                </div>
                <div class="store-search-bar">
                    <i class="ph ph-magnifying-glass"></i>
                    <input type="text" id="store-search-input" placeholder="Buscar produtos...">
                </div>
                <button class="store-cart-btn" onclick="viewClientCart()">
                    <i class="ph ph-shopping-cart"></i>
                    <span class="cart-badge" id="cart-count">0</span>
                </button>
            </div>

            <!-- Promotional Banner -->
            <div class="store-banner" style="display: flex; flex-direction: column; gap: 10px; overflow: hidden;">
                <div class="banner-content">
                    <h2>🔥 OFERTAS ESPECIAIS</h2>
                    <p id="banner-subtitle">Compre agora e economize!</p>
                </div>
                <div id="promo-products-list"
                    style="display: flex; gap: 15px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; width: 100%;">
                    <!-- Promo items will be injected here -->
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="store-quick-actions">
                <button class="action-btn" onclick="filterStorePromotions()">
                    <i class="ph ph-coins"></i>
                    <span>Promoções</span>
                </button>
                <button class="action-btn">
                    <i class="ph ph-percent"></i>
                    <span>Cupons</span>
                </button>
                <button class="action-btn" onclick="openLoyaltyModal()">
                    <i class="ph ph-star" style="color: var(--accent-orange);"></i>
                    <span>LP</span>
                </button>
                <button class="action-btn">
                    <i class="ph ph-gift"></i>
                    <span>Ofertas</span>
                </button>
            </div>

            <!-- Products Grid -->
            <div class="store-products-section">
                <h3>Todos os Produtos</h3>
                <div class="product-grid" id="store-product-grid">
                    <!-- Products will be loaded here via JavaScript -->
                </div>
            </div>

            <!-- Bottom Navigation -->
            <nav class="store-bottom-nav">
                <button class="store-nav-item active" onclick="showStoreHome()">
                    <i class="ph ph-house"></i>
                    <span>Início</span>
                </button>
                <button class="store-nav-item" onclick="viewClientCart()">
                    <i class="ph ph-shopping-cart"></i>
                    <span>Carrinho</span>
                </button>
                <button class="store-nav-item" onclick="viewClientOrders()">
                    <i class="ph ph-package"></i>
                    <span>Pedidos</span>
                </button>
                <button class="store-nav-item" onclick="showClientProfile()">
                    <i class="ph ph-user"></i>
                    <span>Perfil</span>
                </button>
            </nav>
        </div>
    </div>

    <!-- ========== TELA DO CARRINHO (CLIENTES) ========== -->
    <div id="client-cart-screen" class="screen" style="display: none;">
        <div class="store-container">
            <div class="cart-header">
                <button onclick="backToStore()" class="btn-back">
                    <i class="ph ph-arrow-left"></i>
                </button>
                <h2>Meu Carrinho</h2>
            </div>

            <div class="cart-items-container" id="client-cart-items">
                <!-- Cart items will be loaded here -->
            </div>

            <div class="cart-footer">
                <div class="cart-total">
                    <span>Total:</span>
                    <span class="total-amount" id="client-cart-total">R$ 0,00</span>
                </div>

                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; color: #666; font-weight: 600;">Forma de
                        Pagamento</label>
                    <select id="client-payment-method"
                        style="width: 100%; padding: 0.8rem; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; background: white;">
                        <option value="pix">PIX</option>
                        <option value="cartao">Cartão</option>
                        <option value="dinheiro">Dinheiro</option>
                    </select>
                </div>

                <button class="btn-checkout" onclick="checkoutCart()">
                    <i class="ph ph-credit-card"></i> Finalizar Pedido
                </button>
            </div>
        </div>
    </div>

    <!-- Client PIX Modal -->
    <div id="client-pix-modal" class="modal">
        <div class="modal-content" style="text-align: center;">
            <h2 style="color: #1e40af;">Pagamento via PIX</h2>
            <p style="margin-bottom: 1rem;">Escaneie o QR Code abaixo para pagar</p>

            <div id="client-pix-qr"
                style="background: white; padding: 1rem; display: inline-block; border-radius: 8px; margin-bottom: 1rem;">
                <!-- QR Code here -->
            </div>

            <div style="margin-bottom: 1.5rem;">
                <p style="font-size: 0.9rem; color: #666;">Chave PIX:</p>
                <strong id="client-pix-key-display" style="font-size: 1.1rem; user-select: all;"></strong>
            </div>

            <div class="modal-actions">
                <button class="btn-success" onclick="openDeliveryModal()">Já fiz o pagamento</button>
                <button class="btn-secondary" onclick="closeClientPixModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Client Delivery Modal -->
    <div id="client-delivery-modal" class="modal">
        <div class="modal-content" style="text-align: center; max-width: 400px;">
            <h2 style="color: #1e40af; margin-bottom: 1.5rem;"><i class="ph ph-moped"></i> Como deseja receber?</h2>

            <div style="display: grid; gap: 1rem; margin-bottom: 1.5rem;">
                <button class="btn-secondary" onclick="selectDeliveryMethod('delivery')"
                    style="padding: 1.5rem; display: flex; flex-direction: column; align-items: center; gap: 0.5rem; border: 2px solid transparent;">
                    <i class="ph ph-moped" style="font-size: 2rem; color: var(--accent-orange);"></i>
                    <span style="font-weight: bold; font-size: 1.1rem;">Entrega</span>
                    <span style="font-size: 0.8rem; color: #666;">Receba em casa</span>
                </button>

                <button class="btn-secondary" onclick="selectDeliveryMethod('pickup')"
                    style="padding: 1.5rem; display: flex; flex-direction: column; align-items: center; gap: 0.5rem; border: 2px solid transparent;">
                    <i class="ph ph-storefront" style="font-size: 2rem; color: var(--accent-cyan);"></i>
                    <span style="font-weight: bold; font-size: 1.1rem;">Retirada</span>
                    <span style="font-size: 0.8rem; color: #666;">Buscar na loja</span>
                </button>
            </div>

            <button class="btn-text" onclick="closeDeliveryModal()">Voltar</button>
        </div>
    </div>

    <!-- Client Proof Modal -->
    <div id="client-proof-modal" class="modal">
        <div class="modal-content" style="text-align: center; max-width: 400px;">
            <h2 style="color: #1e40af; margin-bottom: 1rem;"><i class="ph ph-receipt"></i> Comprovante</h2>
            <p style="margin-bottom: 1.5rem; color: #666;">Envie o comprovante para agilizar seu pedido</p>

            <form id="proof-form" onsubmit="submitProof(event)">
                <div class="file-upload-area" onclick="document.getElementById('proof-file-input').click()"
                    style="border: 2px dashed #ccc; padding: 2rem; border-radius: 8px; cursor: pointer; margin-bottom: 1.5rem; transition: all 0.2s;">
                    <i class="ph ph-upload-simple" style="font-size: 2rem; color: #999; margin-bottom: 0.5rem;"></i>
                    <p style="color: #666;">Clique para enviar foto</p>
                    <input type="file" id="proof-file-input" accept="image/*" style="display: none;"
                        onchange="previewProof(this)">
                    <img id="proof-preview" src=""
                        style="max-width: 100%; max-height: 200px; margin-top: 1rem; display: none; border-radius: 8px;">
                </div>

                <div class="modal-actions">
                    <button type="submit" class="btn-primary" style="width: 100%;">Enviar Pedido</button>
                </div>
            </form>

            <button class="btn-text" onclick="closeProofModal()" style="margin-top: 1rem;">Voltar</button>
        </div>
    </div>

    <!-- ========== TELA DE PEDIDOS (CLIENTES) ========== -->
    <div id="client-orders-screen" class="screen" style="display: none;">
        <div class="store-container">
            <div class="cart-header">
                <button onclick="backToStore()" class="btn-back">
                    <i class="ph ph-arrow-left"></i>
                </button>
                <h2>Meus Pedidos</h2>
            </div>

            <div class="orders-container" id="client-orders-list">
                <!-- Orders will be loaded here -->
            </div>
        </div>
    </div>

    <!-- ========== TELA DE PERFIL (CLIENTES) ========== -->
    <div id="client-profile-screen" class="screen" style="display: none;">
        <div class="store-container">
            <div class="cart-header">
                <button onclick="backToStore()" class="btn-back">
                    <i class="ph ph-arrow-left"></i>
                </button>
                <h2>Meu Perfil</h2>
            </div>

            <div class="profile-container">
                <div class="profile-info">
                    <i class="ph ph-user-circle" style="font-size: 4rem; color: var(--accent-cyan);"></i>
                    <h3 id="client-profile-name">Cliente</h3>
                    <p id="client-profile-store"
                        style="color: var(--text-secondary); margin-top: 0.5rem; font-size: 0.9rem;"></p>
                    <p id="client-profile-pin">PIN: ****</p>
                </div>

                <div class="profile-actions">
                    <button class="btn-secondary" onclick="logoutClient()" style="width: 100%; margin-top: 2rem;">
                        <i class="ph ph-sign-out"></i> Sair
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== TELA DE ADMINISTRAÇÃO (TP) ========== -->
    <div id="admin-users-screen" class="screen" style="display: none;">
        <div class="store-container">
            <div class="cart-header">
                <button onclick="switchTab('dashboard')" class="btn-back">
                    <i class="ph ph-arrow-left"></i>
                </button>
                <h2>Administração de Usuários</h2>
            </div>
            <div class="table-container" style="background: white; border-radius: 8px; padding: 1rem;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Usuário</th>
                            <th>Email</th>
                            <th>Status</th>
                            <th>Expira em</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="admin-users-table-body">
                        <!-- Users will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ========== TELA DE BLOQUEIO (ASSINATURA) ========== -->
    <div id="subscription-block-screen" class="screen"
        style="display: none; background: #0f172a; align-items: center; justify-content: center;">
        <div class="auth-container" style="text-align: center; max-width: 500px;">
            <div style="color: var(--accent-orange); font-size: 4rem; margin-bottom: 1rem;">
                <i class="ph ph-lock-key"></i>
            </div>
            <h1 style="color: white; margin-bottom: 0.5rem;">Conta Bloqueada</h1>
            <p style="color: #94a3b8; margin-bottom: 2rem;">Sua assinatura expirou ou está inativa. Realize o pagamento
                para continuar.</p>

            <div class="plan-card"
                style="background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 12px; border: 1px solid var(--border-glass); margin-bottom: 2rem;">
                <h3 style="color: white; margin-bottom: 0.5rem;">Plano Mensal</h3>
                <div style="font-size: 2.5rem; font-weight: bold; color: var(--accent-green);">R$ 50,00<span
                        style="font-size: 1rem; color: #94a3b8;">/mês</span></div>
            </div>

            <div style="background: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem;">
                <p style="color: #1e40af; font-weight: bold; margin-bottom: 1rem;">Pagamento via PIX</p>
                <!-- Static QR Code Image or Placeholder logic if we had a generator lib loaded here usually -->
                <div id="block-pix-qr"
                    style="margin-bottom: 1rem; background: #f0f0f0; padding: 10px; display: inline-block;">
                    <!-- QR Code will be rendered here by JS -->
                </div>
                <p style="font-size: 0.9rem; color: #666; margin-bottom: 0.5rem;">Chave PIX:</p>
                <div
                    style="background: #f1f5f9; padding: 0.8rem; border-radius: 8px; font-family: monospace; font-weight: bold; color: #333; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                    <span id="block-pix-key">62819358000106</span>
                    <button onclick="navigator.clipboard.writeText('62819358000106'); alert('Chave PIX copiada!')"
                        style="background: none; border: none; cursor: pointer; color: #3b82f6;">
                        <i class="ph ph-copy"></i>
                    </button>
                </div>
            </div>

            <div style="text-align: left;">
                <label style="color: #94a3b8; display: block; margin-bottom: 0.5rem;">Enviar Comprovante</label>
                <form id="block-proof-form" onsubmit="submitSubscriptionProof(event)"
                    style="display: flex; gap: 0.5rem;">
                    <input type="file" id="subscription-proof-file" accept="image/*" required
                        style="flex: 1; padding: 0.5rem; background: rgba(255,255,255,0.1); border: 1px solid var(--border-glass); border-radius: 8px; color: white;">
                    <button type="submit" class="btn-primary" style="white-space: nowrap;">
                        <i class="ph ph-paper-plane-right"></i> Enviar
                    </button>
                </form>
            </div>

            <button onclick="logout()" class="btn-text" style="margin-top: 2rem; color: #ef4444;">
                <i class="ph ph-sign-out"></i> Sair e tentar outra conta
            </button>
        </div>
    </div>
    <!-- ========== TELA PRINCIPAL DO APP ========== -->
    <div id="app-screen" class="screen" style="display: none;">
        <div class="app-container">
            <!-- Header Redesign -->
            <header class="app-header">
                <div class="header-left">
                    <div class="logo-area">
                        <span style="color: #fca5a5; font-weight: bold;">L-</span><span
                            style="color: white; font-weight: bold;">PDV</span>
                    </div>
                    <button class="header-btn active" onclick="switchTab('dashboard')"><i class="ph ph-house"></i>
                        INÍCIO</button>
                    <button class="header-btn"><i class="ph ph-storefront"></i> MERCADINHO PAMPLONA</button>
                    <button class="header-btn"><i class="ph ph-chart-line-up"></i> RESULTADOS</button>

                </div>
                <div class="header-right">
                    <div id="header-user-display"
                        style="display: flex; align-items: center; gap: 0.5rem; margin-right: 1rem; color: var(--text-secondary); font-weight: 500;">
                        <i class="ph ph-user-circle" style="font-size: 1.2rem;"></i>
                        <span id="header-username">Usuário</span>
                        <span id="header-user-pin" class="pin-badge" style="display: none;">PIN: ****</span>
                    </div>
                    <button class="header-btn"><i class="ph ph-arrows-clockwise"></i> SINCRONIZAR</button>
                    <button class="header-btn"><i class="ph ph-gear"></i> OPÇÕES</button>
                    <!-- Admin TP Button (Hidden by default, shown via JS) -->
                    <button id="admin-tp-btn" class="header-btn" style="display: none; background-color: #3b82f6;"
                        onclick="showAdminUsers()">
                        <i class="ph ph-shield-check"></i> TP
                    </button>
                </div>
            </header>

            <div class="content-wrapper">
                <main class="app-content">
                    <!-- Dashboard Tab (New Grid Layout) -->
                    <div id="dashboard-tab" class="tab-content active">
                        <div class="dashboard-grid-large">
                            <!-- Row 1 -->
                            <button class="dashboard-shortcut blue" onclick="loadReports(); switchTab('reports')">
                                <div class="shortcut-icon"><i class="ph ph-chart-line-up"></i></div>
                                <span>RELATÓRIOS</span>
                            </button>
                            <button class="dashboard-shortcut blue" onclick="loadFinancial(); switchTab('financial')">
                                <div class="shortcut-icon"><i class="ph ph-bank"></i></div>
                                <span>FINANCEIRO</span>
                            </button>
                            <button class="dashboard-shortcut blue" onclick="loadDashboard()">
                                <div class="shortcut-icon"><i class="ph ph-chart-bar"></i></div>
                                <span>VISÃO GERAL</span>
                            </button>
                            <!-- Cash Register Status Card -->
                            <div class="dashboard-shortcut" id="cash-register-status-card"
                                onclick="handleCashRegisterClick()"
                                style="background: var(--surface); border: 1px solid var(--border-glass); cursor: pointer;">
                                <div class="shortcut-icon" id="cash-register-icon"
                                    style="color: var(--text-secondary);"><i class="ph ph-lock-key"></i></div>
                                <span id="cash-register-status-text"
                                    style="font-size: 0.9rem; color: var(--text-secondary);">CAIXA FECHADO</span>
                                <small id="cash-register-balance"
                                    style="display: none; color: var(--success); font-weight: bold;"></small>
                            </div>
                            <button class="dashboard-shortcut brown" onclick="switchTab('products')">
                                <div class="shortcut-icon"><i class="ph ph-package"></i></div>
                                <span>PRODUTOS</span>
                            </button>
                            <button class="dashboard-shortcut grey" onclick="openDebtorModal()">
                                <div class="shortcut-icon"><i class="ph ph-user-plus"></i></div>
                                <span>+ DEVEDOR</span>
                            </button>
                            <button class="dashboard-shortcut teal" onclick="switchTab('boletos')">
                                <div class="shortcut-icon"><i class="ph ph-barcode"></i></div>
                                <span>BOLETOS</span>
                            </button>

                            <!-- Row 2 -->
                            <button class="dashboard-shortcut purple" onclick="switchTab('sales')">
                                <div class="shortcut-icon"><i class="ph ph-receipt"></i></div>
                                <span>VENDAS</span>
                            </button>
                            <button class="dashboard-shortcut teal" onclick="switchTab('estoque')">
                                <div class="shortcut-icon"><i class="ph ph-warehouse"></i></div>
                                <span>ESTOQUE</span>
                            </button>
                            <button class="dashboard-shortcut green" onclick="switchTab('subscription')">
                                <div class="shortcut-icon"><i class="ph ph-crown"></i></div>
                                <span>ASSINATURA</span>
                            </button>
                            <button class="dashboard-shortcut green-light" onclick="switchTab('store')">
                                <div class="shortcut-icon"><i class="ph ph-gear"></i></div>
                                <span>CONFIGURAÇÃO</span>
                            </button>
                            <button class="dashboard-shortcut orange" onclick="switchTab('accounting')">
                                <div class="shortcut-icon"><i class="ph ph-calculator"></i></div>
                                <span>CONTABILIDADE</span>
                            </button>
                            <button class="dashboard-shortcut red" onclick="logout()">
                                <div class="shortcut-icon"><i class="ph ph-sign-out"></i></div>
                                <span>SAIR</span>
                            </button>
                        </div>
                    </div>

                    <!-- Caixa Tab (Redesigned) -->
                    <div id="caixa-tab" class="tab-content">
                        <div class="pos-layout">
                            <!-- Header -->
                            <div class="pos-header">
                                <div class="pos-status-bar">CAIXA OCUPADO</div>
                                <div id="pos-clock">00:00:00</div>
                                <div>Cliente: <span id="pos-client-name">CLIENTE PADRÃO</span></div>
                            </div>

                            <div class="pos-watermark">
                                <i class="ph ph-shopping-cart"></i>
                            </div>

                            <div class="pos-main-container">
                                <!-- Left Panel -->
                                <div class="pos-panel-left">
                                    <div class="pos-qty-display">
                                        <div class="pos-qty-number" id="pos-qty-display">1</div>
                                        <div class="pos-product-desc" id="pos-product-desc">AGUARDANDO PRODUTO...</div>
                                    </div>

                                    <div class="pos-image-container">
                                        <img id="pos-product-image" src="" alt="Produto" style="display: none;">
                                        <div id="pos-image-placeholder" style="color: #ccc; font-size: 5rem;"><i
                                                class="ph ph-image"></i></div>
                                    </div>

                                    <div class="pos-input-group">
                                        <label class="pos-input-label">Código de Barras</label>
                                        <input type="text" id="barcode-input" class="pos-input"
                                            placeholder="Escaneie ou digite..." autofocus>
                                    </div>

                                    <div class="pos-input-group" style="position: relative;">
                                        <label class="pos-input-label">Buscar Produto por Nome</label>
                                        <div style="display: flex; gap: 0.5rem;">
                                            <input type="text" id="product-search-input" class="pos-input"
                                                placeholder="Digite o nome..." style="font-size: 1.2rem; flex: 1;">
                                            <button class="pos-btn pos-btn-blue" onclick="showAllProductsInSearch()"
                                                style="padding: 0.5rem 1rem; font-size: 1.2rem;" title="Listar Todos">
                                                <i class="ph ph-list"></i>
                                            </button>
                                        </div>
                                        <div id="search-results-dropdown" class="search-dropdown"
                                            style="display: none;"></div>
                                    </div>

                                    <div class="pos-price-display">
                                        <label class="pos-input-label">Valor Unitário</label>
                                        <div class="pos-price-value" id="pos-unit-price">R$ 0,00</div>
                                    </div>

                                    <!-- Payment Methods Removed -->
                                    <input type="hidden" id="payment-method" value="dinheiro">
                                    <input type="hidden" id="payment-method" value="dinheiro">

                                    <div style="margin-top: auto; color: #666; font-size: 0.9rem;">
                                        Vendedor: <span id="pos-vendor">Administrador</span> | Itens: <span
                                            id="pos-item-count">0</span>
                                    </div>
                                </div>

                                <!-- Right Panel -->
                                <div class="pos-panel-right">
                                    <div class="pos-cart-table-container">
                                        <table class="pos-table">
                                            <thead>
                                                <tr>
                                                    <th>Item</th>
                                                    <th>Img</th>
                                                    <th>Código</th>
                                                    <th>Descrição</th>
                                                    <th>UN</th>
                                                    <th>Qtd</th>
                                                    <th>Vl. Unit</th>
                                                    <th>Total</th>
                                                    <th><i class="ph ph-trash"></i></th>
                                                </tr>
                                            </thead>
                                            <tbody id="cart-items">
                                                <!-- Items will be injected here -->
                                            </tbody>
                                        </table>
                                    </div>

                                    <div class="pos-totals-area">
                                        <div class="pos-total-row">
                                            <span class="pos-total-label">TOTAL LÍQUIDO</span>
                                            <span class="pos-total-value" id="cart-total">R$ 0,00</span>
                                        </div>

                                        <div class="pos-payment-row">
                                            <div>
                                                <label class="pos-input-label">Total Pago</label>
                                                <input type="number" id="pos-paid-amount"
                                                    class="pos-input pos-payment-input" placeholder="0,00">
                                            </div>
                                            <div>
                                                <label class="pos-input-label">Troco</label>
                                                <div class="pos-change-display" id="pos-change-value">R$ 0,00</div>
                                            </div>
                                        </div>

                                        <div class="pos-actions">
                                            <button class="pos-btn pos-btn-green" id="btn-new-sale">F2 Nova
                                                Venda</button>
                                            <button class="pos-btn pos-btn-blue" id="finalize-sale">F7
                                                Finalizar</button>
                                            <button class="pos-btn pos-btn-yellow" id="btn-cancel-item">F6 Cancelar
                                                Item</button>
                                            <button class="pos-btn pos-btn-red" id="clear-cart">F11 Cancelar
                                                Venda</button>
                                            <button class="pos-btn" style="background-color: #8b5cf6; color: white;"
                                                onclick="toggleOnlineOrdersPanel()">
                                                <i class="ph ph-chat-circle-text"></i> Pedidos Online <span
                                                    id="online-orders-badge"
                                                    style="background: red; color: white; border-radius: 50%; padding: 2px 6px; font-size: 0.7rem; display: none;">0</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- PIX Overlay (Hidden by default) -->


                            <!-- Online Orders Panel (Chat Style) -->
                            <div id="online-orders-panel" class="pos-panel-right"
                                style="display: none; position: absolute; right: 0; top: 0; bottom: 0; width: 400px; background: #f0f2f5; z-index: 100; border-left: 1px solid #ddd; box-shadow: -5px 0 15px rgba(0,0,0,0.1); flex-direction: column;">
                                <div
                                    style="padding: 1rem; background: white; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                    <h3
                                        style="margin: 0; color: #1e40af; display: flex; align-items: center; gap: 0.5rem;">
                                        <i class="ph ph-chat-circle-text" style="font-size: 1.5rem;"></i>
                                        Pedidos Online
                                    </h3>
                                    <button class="btn-close" onclick="toggleOnlineOrdersPanel()"
                                        style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">
                                        <i class="ph ph-x"></i>
                                    </button>
                                </div>
                                <div id="online-orders-list"
                                    style="flex: 1; overflow-y: auto; padding: 1rem; display: flex; flex-direction: column; gap: 1rem;">
                                    <!-- Orders will be injected here -->
                                    <div
                                        style="text-align: center; color: #999; margin-top: 2rem; display: flex; flex-direction: column; align-items: center; gap: 1rem;">
                                        <i class="ph ph-check-circle" style="font-size: 3rem; color: #ddd;"></i>
                                        <span>Nenhum pedido pendente</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Split Payment Modal -->
                            <div id="split-payment-modal" class="modal-overlay" style="display: none;">
                                <div class="modal-content" style="max-width: 500px;">
                                    <div class="modal-header">
                                        <h2><i class="ph ph-coins"></i> Pagamento Misto</h2>
                                        <button class="btn-close" onclick="closeSplitPaymentModal()">&times;</button>
                                    </div>
                                    <div class="modal-body">
                                        <div style="margin-bottom: 1rem; text-align: center;">
                                            <div style="font-size: 1.2rem;">Total da Venda</div>
                                            <div id="split-total-amount"
                                                style="font-size: 2rem; font-weight: bold; color: var(--text-primary);">
                                                R$ 0,00</div>
                                        </div>

                                        <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                                            <select id="split-payment-method" class="form-input" style="flex: 1;">
                                                <option value="dinheiro">Dinheiro</option>
                                                <option value="cartao">Cartão</option>
                                                <option value="pix">PIX</option>
                                            </select>
                                            <input type="number" id="split-payment-amount" class="form-input"
                                                placeholder="Valor" style="width: 120px;" min="0.01" step="0.01">
                                            <button class="btn-primary" onclick="addSplitPayment()">Adicionar</button>
                                        </div>

                                        <div class="table-container"
                                            style="max-height: 200px; overflow-y: auto; margin-bottom: 1rem;">
                                            <table class="data-table">
                                                <thead>
                                                    <tr>
                                                        <th>Método</th>
                                                        <th>Valor</th>
                                                        <th></th>
                                                    </tr>
                                                </thead>
                                                <tbody id="split-payments-list"></tbody>
                                            </table>
                                        </div>

                                        <div
                                            style="display: flex; justify-content: space-between; font-size: 1.1rem; font-weight: bold; margin-top: 1rem; border-top: 1px solid var(--border-glass); padding-top: 1rem;">
                                            <span>Restante:</span>
                                            <span id="split-remaining-amount" style="color: var(--danger);">R$
                                                0,00</span>
                                        </div>

                                        <div id="split-change-display"
                                            style="display: none; justify-content: space-between; font-size: 1.1rem; font-weight: bold; color: var(--success);">
                                            <span>Troco:</span>
                                            <span id="split-change-value">R$ 0,00</span>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button class="btn-secondary"
                                            onclick="closeSplitPaymentModal()">Cancelar</button>
                                        <button id="btn-finalize-split" class="btn-primary"
                                            onclick="finalizeSplitSale()" disabled>Finalizar Venda</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
            </div>

            <!-- Products Tab (Full Width List) -->
            <div id="products-tab" class="tab-content">
                <div class="products-layout" style="display: block; height: calc(100vh - 140px);">
                    <!-- Form Panel Removed -->

                    <!-- Right Panel: Product List -->
                    <div class="products-list-panel" style="height: 100%;">
                        <div class="list-header"
                            style="display: flex; align-items: center; justify-content: space-between; gap: 1rem;">
                            <h2 style="white-space: nowrap;"><i class="ph ph-list"></i> Lista de
                                Produtos</h2>
                            <button class="btn-primary" onclick="openProductModal()"
                                style="white-space: nowrap; padding: 0.4rem 0.6rem; font-size: 0.85rem; width: auto;">
                                <i class="ph ph-plus"></i> Novo Produto
                            </button>
                            <div class="product-search-container" style="flex: 2; position: relative;">
                                <i class="ph ph-magnifying-glass"
                                    style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: var(--text-secondary);"></i>
                                <input type="text" id="product-list-search"
                                    placeholder="Buscar por nome, código ou categoria..." onkeyup="filterProductsList()"
                                    style="width: 100%; padding: 0.6rem 0.6rem 0.6rem 2.5rem; border-radius: 8px; border: 1px solid #0ea5e9; background: rgba(14, 165, 233, 0.1); color: #333; font-size: 0.95rem;">
                            </div>


                        </div>
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Img</th>
                                        <th>Código</th>
                                        <th>Nome</th>
                                        <th>Cat.</th>
                                        <th>Preço</th>
                                        <th>Est.</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="products-table-body"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Estoque Tab -->
            <div id="estoque-tab" class="tab-content">
                <h2><i class="ph ph-warehouse"></i> Controle de Estoque</h2>

                <!-- Cards de Resumo -->
                <div class="dashboard-grid" style="margin-bottom: 2rem;">
                    <div class="dashboard-card">
                        <div class="card-icon"><i class="ph ph-package"></i></div>
                        <div class="card-info">
                            <h3>Total em Estoque</h3>
                            <p id="total-stock-items" class="card-value">0</p>
                        </div>
                    </div>
                    <div class="dashboard-card warning">
                        <div class="card-icon"><i class="ph ph-warning"></i></div>
                        <div class="card-info">
                            <h3>Estoque Baixo</h3>
                            <p id="low-stock-products" class="card-value">0</p>
                        </div>
                    </div>
                    <div class="dashboard-card danger">
                        <div class="card-icon"><i class="ph ph-prohibit"></i></div>
                        <div class="card-info">
                            <h3>Sem Estoque</h3>
                            <p id="out-of-stock-products" class="card-value">0</p>
                        </div>
                    </div>
                </div>

                <!-- Botões de Ação -->
                <div class="tab-header">
                    <h3><i class="ph ph-arrows-clockwise"></i> Movimentações de Estoque</h3>
                    <div style="display: flex; gap: 1rem;">
                        <input type="text" id="stock-search" placeholder="Buscar produto..."
                            style="padding: 0.5rem; border-radius: 8px; border: 1px solid var(--border-glass); background: rgba(255,255,255,0.05); color: white;">
                        <button id="add-stock-movement-btn" class="btn-primary">+ Nova
                            Movimentação</button>
                    </div>
                </div>

                <!-- Tabela de Movimentações -->
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Produto</th>
                                <th>Tipo</th>
                                <th>Quantidade</th>
                                <th>Estoque Anterior</th>
                                <th>Estoque Atual</th>
                                <th>Motivo</th>
                            </tr>
                        </thead>
                        <tbody id="stock-movements-table-body"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Sales Tab -->
        <div id="sales-tab" class="tab-content">
            <h2><i class="ph ph-trend-up"></i> Histórico de Vendas</h2>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Data</th>
                            <th>Itens</th>
                            <th>Pagamento</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody id="sales-table-body"></tbody>
                </table>
            </div>
        </div>

        <!-- Boletos Tab -->
        <div id="boletos-tab" class="tab-content">
            <div class="tab-header">
                <h2><i class="ph ph-barcode"></i> Gerenciamento de Boletos</h2>
                <button id="add-boleto-btn" class="btn-primary"
                    style="width: auto; min-width: 150px; padding: 0.6rem 1.2rem;">+ Novo Boleto</button>
            </div>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Descrição</th>
                            <th>Valor</th>
                            <th>Vencimento</th>
                            <th>Status</th>
                            <th>Dias Restantes</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="boletos-table-body"></tbody>
                </table>
            </div>
        </div>

        <!-- Devedores Tab -->
        <div id="debtors-tab" class="tab-content">
            <div class="tab-header">
                <h2><i class="ph ph-users"></i> Devedores (Fiado)</h2>
                <button id="add-debtor-btn" class="btn-primary" onclick="openDebtorModal()">+ Novo
                    Devedor</button>
            </div>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>CPF</th>
                            <th>Telefone</th>
                            <th>Dívida Atual</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="debtors-table-body"></tbody>
                </table>
            </div>
        </div>

        <!-- Relatórios Tab -->
        <!-- Relatórios Tab -->
        <div id="reports-tab" class="tab-content">
            <h2><i class="ph ph-chart-line-up"></i> Painel de Relatórios</h2>

            <div class="dashboard-grid-large" style="margin-bottom: 2rem;">
                <!-- Vendas -->
                <button class="dashboard-shortcut blue" onclick="generateReport('sales-general')">
                    <div class="shortcut-icon"><i class="ph ph-receipt"></i></div>
                    <span>Relatório de Vendas Gerais</span>
                </button>
                <button class="dashboard-shortcut blue" onclick="generateReport('sales-cashier')">
                    <div class="shortcut-icon"><i class="ph ph-cash-register"></i></div>
                    <span>Relatório de Vendas do Caixa</span>
                </button>

                <!-- Boletos -->
                <button class="dashboard-shortcut teal" onclick="generateReport('boletos')">
                    <div class="shortcut-icon"><i class="ph ph-barcode"></i></div>
                    <span>Relatório de Boletos</span>
                </button>

                <!-- Estoque -->
                <button class="dashboard-shortcut purple" onclick="generateReport('stock-current')">
                    <div class="shortcut-icon"><i class="ph ph-package"></i></div>
                    <span>Estoque Atual</span>
                </button>
                <button class="dashboard-shortcut green" onclick="generateReport('stock-entry')">
                    <div class="shortcut-icon"><i class="ph ph-arrow-down"></i></div>
                    <span>Entrada de Mercadoria</span>
                </button>
                <button class="dashboard-shortcut orange" onclick="generateReport('stock-exit')">
                    <div class="shortcut-icon"><i class="ph ph-arrow-up"></i></div>
                    <span>Saída de Mercadoria</span>
                </button>

                <!-- Financeiro/Clientes -->
                <button class="dashboard-shortcut pink" onclick="generateReport('payments-pix-cash')">
                    <div class="shortcut-icon"><i class="ph ph-currency-circle-dollar"></i></div>
                    <span>PIX vs Dinheiro</span>
                </button>
                <button class="dashboard-shortcut red" onclick="generateReport('debtors')">
                    <div class="shortcut-icon"><i class="ph ph-users"></i></div>
                    <span>Clientes Devedores</span>
                </button>
            </div>

            <!-- Área de Exibição do Relatório Gerado -->
            <div id="report-result-container"
                style="background: white; padding: 2rem; border-radius: 12px; display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h3 id="report-title" style="color: var(--primary);">Título do Relatório</h3>
                    <button class="btn-secondary" onclick="printReport()"><i class="ph ph-printer"></i>
                        Imprimir</button>
                </div>
                <div id="report-content" style="max-height: 500px; overflow-y: auto;">
                    <!-- Tabela do relatório será gerada aqui -->
                </div>
            </div>
        </div>

        <!-- Financeiro Tab -->
        <div id="financial-tab" class="tab-content">
            <h2><i class="ph ph-bank"></i> Financeiro</h2>
            <div class="dashboard-grid">
                <div class="dashboard-card success">
                    <div class="card-icon"><i class="ph ph-arrow-up"></i></div>
                    <div class="card-info">
                        <h3>Receitas</h3>
                        <p id="fin-income" class="card-value">R$ 0,00</p>
                    </div>
                </div>
                <div class="dashboard-card danger">
                    <div class="card-icon"><i class="ph ph-arrow-down"></i></div>
                    <div class="card-info">
                        <h3>Despesas</h3>
                        <p id="fin-expenses" class="card-value">R$ 0,00</p>
                    </div>
                </div>
                <div class="dashboard-card">
                    <div class="card-icon"><i class="ph ph-scales"></i></div>
                    <div class="card-info">
                        <h3>Saldo</h3>
                        <p id="fin-balance" class="card-value">R$ 0,00</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contabilidade Tab -->
        <div id="accounting-tab" class="tab-content">
            <h2><i class="ph ph-calculator"></i> Contabilidade</h2>
            <div class="tab-header">
                <h3>Livro Caixa</h3>
                <button class="btn-secondary"><i class="ph ph-download"></i> Exportar
                    XML/CSV</button>
            </div>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Descrição</th>
                            <th>Tipo</th>
                            <th>Valor</th>
                        </tr>
                    </thead>
                    <tbody id="accounting-table-body"></tbody>
                </table>
            </div>
        </div>

        <!-- Assinatura Tab -->
        <!-- Assinatura Tab -->
        <div id="subscription-tab" class="tab-content">
            <h2><i class="ph ph-crown"></i> Assinatura Premium</h2>

            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <div class="card-icon"><i class="ph ph-check-circle"></i></div>
                    <div class="card-info">
                        <h3>Status da Assinatura</h3>
                        <p id="sub-status" class="card-value" style="color: var(--success);">Ativo</p>
                        <small id="sub-expires">Expira em: 30 dias</small>
                    </div>
                </div>
            </div>

            <div class="subscription-renewal-area"
                style="margin-top: 2rem; background: var(--bg-secondary); padding: 2rem; border-radius: 12px; display: flex; flex-direction: column; align-items: center; text-align: center;">
                <h3 style="margin-bottom: 1rem; color: var(--accent-purple);">Renovar Assinatura - R$ 50,00</h3>
                <p style="margin-bottom: 1.5rem; color: var(--text-secondary);">Escaneie o QR Code abaixo para pagar via
                    PIX</p>

                <!-- QR Code Container -->
                <div id="sub-qr-code"
                    style="background: white; padding: 1rem; border-radius: 12px; margin-bottom: 2rem; box-shadow: 0 4px 15px rgba(0,0,0,0.3);">
                    <!-- QR Code Injected via JS -->
                </div>

                <div
                    style="background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 8px; width: 100%; max-width: 500px;">
                    <h4 style="margin-bottom: 1rem;"><i class="ph ph-upload-simple"></i> Enviar Comprovante</h4>
                    <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">Envie o comprovante
                        para confirmar sua renovação.</p>

                    <div class="form-group">
                        <input type="file" id="sub-proof-file" accept="image/*" class="pos-input">
                    </div>
                    <button class="btn-primary" onclick="uploadSubscriptionProof()" style="width: 100%;">
                        <i class="ph ph-paper-plane-right"></i> Enviar Comprovante
                    </button>
                </div>
            </div>
        </div>

        <!-- Store Tab (Loja/Config) -->
        <div id="store-tab" class="tab-content">
            <h2><i class="ph ph-storefront"></i> Configurações da Loja</h2>
            <div class="auth-form" style="max-width: 600px; margin: 0;">
                <h3>Dados de Pagamento</h3>
                <div class="form-group">
                    <label>Chave PIX (Assinatura)</label>
                    <input type="text" value="62819358000106" readonly
                        style="background: rgba(0,0,0,0.3); color: var(--text-secondary);">
                    <small style="color: var(--accent-orange);">* Esta chave não pode ser
                        alterada.</small>
                </div>
                <div class="form-group">
                    <label>Chave PIX (Recebimento Loja)</label>
                    <input type="text" id="store-pix-key" placeholder="Sua chave PIX para receber vendas">
                </div>

                <hr style="margin: 1.5rem 0; border: 0; border-top: 1px solid rgba(255,255,255,0.1);">

                <h3>Segurança da Loja</h3>
                <div class="form-group">
                    <label>PIN do Vendedor (Acesso Clientes)</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="store-seller-pin" placeholder="Crie um PIN (Ex: 1234)" maxlength="6"
                            pattern="\d*">
                        <button class="btn-secondary" onclick="updateSellerPin()"
                            style="width: auto; white-space: nowrap;">
                            <i class="ph ph-floppy-disk"></i> Salvar PIN
                        </button>
                    </div>
                    <small style="color: var(--text-secondary);">Este PIN será usado pelos seus clientes
                        para
                        acessar sua loja.</small>
                </div>

                <hr style="margin: 1.5rem 0; border: 0; border-top: 1px solid rgba(255,255,255,0.1);">

                <h3>Sistema de Fidelidade (LP)</h3>
                <div class="form-group" style="flex-direction: row; align-items: center; gap: 10px;">
                    <input type="checkbox" id="enable-loyalty" style="width: auto; margin: 0;">
                    <label for="enable-loyalty" style="margin: 0; cursor: pointer;">Ativar Sistema de
                        Pontos</label>
                </div>
                <div class="form-group" id="loyalty-rate-group" style="display: none;">
                    <label>Taxa de Cashback (%)</label>
                    <input type="number" id="loyalty-cashback-rate" placeholder="Ex: 5" min="0" max="100" step="0.1">
                    <small style="color: var(--text-secondary);">Porcentagem da compra que volta como pontos
                        (1 LP =
                        R$ 0,01)</small>
                </div>

                <hr style="margin: 1.5rem 0; border: 0; border-top: 1px solid rgba(255,255,255,0.1);">

                <h3>Backup e Restauração</h3>
                <div class="form-group">
                    <label>Fazer Backup</label>
                    <button class="btn-secondary" onclick="downloadBackup()" style="width: auto;">
                        <i class="ph ph-download"></i> Baixar Backup Completo (ZIP)
                    </button>
                    <small style="color: var(--text-secondary);">Salva todos os produtos, fotos, relatórios e
                        histórico.</small>
                </div>

                <div class="form-group">
                    <label>Restaurar Backup</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="file" id="backup-file-input" accept=".zip" style="display: none;"
                            onchange="document.getElementById('backup-file-name').textContent = this.files[0] ? this.files[0].name : 'Nenhum arquivo selecionado'">
                        <button class="btn-secondary" onclick="document.getElementById('backup-file-input').click()"
                            style="width: auto;">
                            <i class="ph ph-folder-open"></i> Selecionar Arquivo
                        </button>
                        <span id="backup-file-name"
                            style="align-self: center; color: var(--text-secondary); font-size: 0.9rem; flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">Nenhum
                            arquivo selecionado</span>
                    </div>
                    <button id="btn-restore-backup" class="btn-primary" onclick="restoreBackup()"
                        style="margin-top: 0.5rem; background-color: var(--danger); width: auto;">
                        <i class="ph ph-arrow-counter-clockwise"></i> Restaurar Backup
                    </button>
                    <small style="color: var(--danger);">ATENÇÃO: Restaurar um backup substituirá TODOS os dados
                        atuais.</small>
                </div>

                <hr style="margin: 1.5rem 0; border: 0; border-top: 1px solid rgba(255,255,255,0.1);">


                <button class="btn-primary" onclick="saveStoreConfig()" style="width: auto;">Salvar
                    Configurações</button>
            </div>
        </div>

        <!-- Admin Tab -->
        <div id="admin-tab" class="tab-content">
            <h2><i class="ph ph-gear"></i> Administração</h2>
            <div class="admin-section">
                <h3><i class="ph ph-users"></i> Usuários Cadastrados</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>Email</th>
                                <th>Tipo</th>
                                <th>Cadastro</th>
                                <th>Status Assinatura</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="admin-users-table-body"></tbody>
                    </table>
                </div>
            </div>
        </div>
        </main>

        <!-- Bottom Navigation (Fixed) -->
        <nav class="bottom-nav" style="display: none;">
            <button class="nav-item active-green" data-tab="caixa">
                <i class="ph ph-cash-register"></i>
                <span>CAIXA</span>
            </button>
            <button class="nav-item" data-tab="sales">
                <i class="ph ph-receipt"></i>
                <span>VENDAS</span>
            </button>
            <!-- <button class="nav-item" data-tab="boletos">
                        <i class="ph ph-barcode"></i>
                        <span>BOLETOS</span>
                    </button> -->
            <button class="nav-item" data-tab="accounting">
                <i class="ph ph-book-open"></i>
                <span>CONTABILIDADE</span>
            </button>
            <button class="nav-item" data-tab="financial">
                <i class="ph ph-currency-dollar"></i>
                <span>FINANCEIRO</span>
            </button>
            <button class="nav-item" data-tab="store">
                <i class="ph ph-storefront"></i>
                <span>LOJA</span>
            </button>
            <button class="nav-item" data-tab="estoque">
                <i class="ph ph-package"></i>
                <span>ESTOQUE</span>
            </button>
            <button class="nav-item" data-tab="products">
                <i class="ph ph-shopping-bag"></i>
                <span>PRODUTOS</span>
            </button>
            <button class="nav-item" data-tab="debtors">
                <i class="ph ph-users"></i>
                <span>DEVEDORES</span>
            </button>
        </nav>
    </div>
    </div>
    </div>


    <!-- Modal de Movimentação de Estoque -->
    <div id="stock-movement-modal" class="modal">
        <div class="modal-content">
            <h2 id="stock-movement-modal-title">Nova Movimentação de Estoque</h2>
            <form id="stock-movement-form">
                <div class="form-group">
                    <label><i class="ph ph-package"></i> Produto</label>
                    <select id="stock-product-id" required>
                        <option value="">Selecione um produto...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label><i class="ph ph-swap"></i> Tipo de Movimentação</label>
                    <select id="stock-movement-type" required>
                        <option value="entrada">➕ Entrada (Adicionar)</option>
                        <option value="saida">➖ Saída (Remover)</option>
                        <option value="ajuste">🔧 Ajuste Manual</option>
                    </select>
                </div>
                <div class="form-group">
                    <label><i class="ph ph-hash"></i> Quantidade</label>
                    <input type="number" id="stock-quantity" required min="1" placeholder="0">
                </div>
                <div class="form-group">
                    <label><i class="ph ph-note"></i> Motivo</label>
                    <input type="text" id="stock-reason" required
                        placeholder="Ex: Compra de fornecedor, Perda, Correção...">
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">Salvar</button>
                    <button type="button" onclick="closeStockMovementModal()" class="btn-secondary">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Boleto -->
    <div id="boleto-modal" class="modal">
        <div class="modal-content">
            <h2 id="boleto-modal-title">Novo Boleto</h2>
            <form id="boleto-form">
                <input type="hidden" id="boleto-id">
                <div class="form-group">
                    <label><i class="ph ph-file-text"></i> Descrição</label>
                    <input type="text" id="boleto-description" required placeholder="Ex: Conta de Luz, Aluguel...">
                </div>
                <div class="form-group">
                    <label><i class="ph ph-currency-dollar"></i> Valor (R$)</label>
                    <input type="number" id="boleto-value" step="0.01" required placeholder="0.00" min="0.01">
                </div>
                <div class="form-group">
                    <label><i class="ph ph-calendar"></i> Data de Vencimento</label>
                    <input type="date" id="boleto-duedate" required>
                </div>
                <div class="form-group">
                    <label><i class="ph ph-info"></i> Status</label>
                    <select id="boleto-status">
                        <option value="pendente">Pendente</option>
                        <option value="pago">Pago</option>
                        <option value="vencido">Vencido</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">Salvar</button>
                    <button type="button" onclick="closeBoletoModal()" class="btn-secondary">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Devedor -->
    <div id="debtor-modal" class="modal">
        <div class="modal-content">
            <h2 id="debtor-modal-title">Novo Devedor</h2>
            <form id="debtor-form">
                <input type="hidden" id="debtor-id">
                <div class="form-group">
                    <label>Nome Completo</label>
                    <input type="text" id="debtor-name" required>
                </div>
                <div class="form-group">
                    <label>Email (Gmail)</label>
                    <input type="email" id="debtor-email" required placeholder="cliente@gmail.com">
                </div>
                <div class="form-group">
                    <label>CPF</label>
                    <input type="text" id="debtor-cpf" oninput="maskCPF(this)">
                </div>
                <div class="form-group">
                    <label>Telefone</label>
                    <input type="text" id="debtor-phone">
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">Salvar</button>
                    <button type="button" onclick="closeDebtorModal()" class="btn-secondary">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Pagamento de Dívida -->
    <div id="pay-debt-modal" class="modal">
        <div class="modal-content">
            <h2>Abater Dívida</h2>
            <p id="pay-debt-customer-name" style="margin-bottom: 1rem; font-weight: bold;"></p>
            <form id="pay-debt-form">
                <input type="hidden" id="pay-debt-id">
                <div class="form-group">
                    <label>Valor a Pagar (R$)</label>
                    <input type="number" id="pay-debt-amount" step="0.01" required min="0.01">
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn-success">Confirmar Pagamento</button>
                    <button type="button" onclick="closePayDebtModal()" class="btn-secondary">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ========== MODAL DE ABERTURA DE CAIXA ========== -->
    <div id="cash-register-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="cash-register-modal-title">Abertura de Caixa</h2>
                <button class="close-modal" onclick="closeCashRegisterModal()">&times;</button>
            </div>
            <form id="cash-register-form">
                <div class="form-group">
                    <label>Valor Inicial (Fundo de Troco)</label>
                    <input type="number" id="cash-register-opening-balance" step="0.01" min="0.01" placeholder="0.00"
                        required>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeCashRegisterModal()">Cancelar</button>
                    <button type="submit" class="btn-primary">Abrir Caixa</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ========== MODAL DE PAGAMENTO (NOVO) ========== -->
    <div id="payment-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>Finalizar Venda</h2>
                <button class="close-modal" onclick="closePaymentModal()">&times;</button>
            </div>

            <!-- Client Selection -->
            <div class="form-group" style="margin-bottom: 1.5rem; text-align: left;">
                <label><i class="ph ph-user"></i> Cliente (Fidelidade)</label>
                <div style="display: flex; gap: 10px;">
                    <select id="payment-client-select"
                        style="flex: 1; padding: 10px; border-radius: 8px; border: 1px solid var(--border-glass); background: var(--bg-glass); color: var(--text-primary);">
                        <option value="">Cliente Não Identificado</option>
                    </select>
                    <button class="btn-secondary" onclick="openNewClientModal()" title="Novo Cliente"
                        style="width: auto; padding: 0 1rem;">
                        <i class="ph ph-plus"></i>
                    </button>
                </div>
                <small id="client-loyalty-info"
                    style="color: var(--accent-orange); display: none; margin-top: 5px;">Saldo: 0 LP</small>
            </div>

            <div style="text-align: center; margin-bottom: 2rem;">
                <div style="font-size: 1.2rem; color: var(--text-secondary);">Total a Pagar</div>
                <div id="payment-modal-total" style="font-size: 3rem; font-weight: 800; color: var(--accent-green);">R$
                    0,00</div>
            </div>

            <div class="payment-options-grid"
                style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-bottom: 2rem;">
                <button class="payment-option-btn active" onclick="selectModalPayment('dinheiro')" id="btn-modal-money">
                    <i class="ph ph-money" style="font-size: 2rem; margin-bottom: 0.5rem;"></i>
                    Dinheiro
                </button>
                <button class="payment-option-btn" onclick="selectModalPayment('cartao')" id="btn-modal-card">
                    <i class="ph ph-credit-card" style="font-size: 2rem; margin-bottom: 0.5rem;"></i>
                    Cartão
                </button>
                <button class="payment-option-btn" onclick="selectModalPayment('pix')" id="btn-modal-pix">
                    <i class="ph ph-qr-code" style="font-size: 2rem; margin-bottom: 0.5rem;"></i>
                    PIX
                </button>
                <button class="payment-option-btn" onclick="selectModalPayment('pontos')" id="btn-modal-points">
                    <i class="ph ph-star" style="font-size: 2rem; margin-bottom: 0.5rem;"></i>
                    Pontos
                </button>
            </div>

            <div id="cash-payment-area"
                style="background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem;">
                <div class="form-group">
                    <label style="font-size: 1.1rem;">Valor Recebido (R$)</label>
                    <input type="number" id="modal-amount-paid" class="pos-input"
                        style="font-size: 1.5rem; text-align: center;" placeholder="0,00" min="0.01" step="0.01"
                        oninput="calculateModalChange()">
                </div>
                <div
                    style="display: flex; justify-content: space-between; align-items: center; margin-top: 1rem; font-size: 1.2rem;">
                    <span>Troco:</span>
                    <span id="modal-change" style="font-weight: bold; color: var(--accent-cyan);">R$ 0,00</span>
                </div>
            </div>



            <div class="modal-actions">
                <button class="btn-secondary" onclick="closePaymentModal()">Cancelar</button>
                <button class="btn-success" onclick="confirmPayment()" style="flex: 2; font-size: 1.2rem;">CONFIRMAR
                    PAGAMENTO</button>
            </div>
        </div>
    </div>

    <!-- ========== MODAL DE PIX (NOVO) ========== -->
    <div id="pix-modal" class="modal-overlay" style="display: none; z-index: 2000;">
        <div class="modal-content" style="max-width: 600px; text-align: center;">
            <div class="modal-header">
                <h2><i class="ph ph-qr-code"></i> Pagamento via PIX</h2>
                <button class="close-modal" onclick="closePixModal()">&times;</button>
            </div>

            <div style="margin-bottom: 2rem;">
                <div style="font-size: 1.2rem; color: var(--text-secondary); margin-bottom: 1rem;">Escaneie o QR Code
                    abaixo</div>
                <div id="pix-qr-container"
                    style="background: white; padding: 1.5rem; border-radius: 16px; display: inline-block; box-shadow: 0 4px 20px rgba(0,0,0,0.2);">
                    <!-- QR Code will be injected here -->
                </div>
            </div>

            <div id="pix-timer"
                style="font-size: 1.5rem; color: var(--accent-orange); font-weight: 800; margin-bottom: 2rem;">
                Atualiza em: 02:00
            </div>

            <div class="modal-actions" style="justify-content: center; gap: 1rem;">
                <button class="btn-secondary" onclick="closePixModal()" style="min-width: 150px;">
                    <i class="ph ph-arrow-left"></i> Voltar
                </button>
                <button class="btn-success" onclick="confirmPayment()" style="min-width: 200px; font-size: 1.2rem;">
                    <i class="ph ph-check"></i> CONFIRMAR PAGAMENTO
                </button>
            </div>
        </div>
    </div>

    <!-- ========== MODAL NOVO CLIENTE ========== -->
    <div id="new-client-modal" class="modal-overlay" style="display: none; z-index: 2100;">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2><i class="ph ph-user-plus"></i> Novo Cliente</h2>
                <button class="close-modal" onclick="closeNewClientModal()">&times;</button>
            </div>
            <form id="new-client-form">
                <div class="form-group">
                    <label>Nome</label>
                    <input type="text" id="new-client-name" required>
                </div>
                <div class="form-group">
                    <label>CPF (Opcional)</label>
                    <input type="text" id="new-client-cpf" oninput="maskCPF(this)">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeNewClientModal()">Cancelar</button>
                    <button type="submit" class="btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ========== MODAL NOVO CLIENTE ========== -->
    <div id="new-client-modal" class="modal-overlay" style="display: none; z-index: 2100;">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2><i class="ph ph-user-plus"></i> Novo Cliente</h2>
                <button class="close-modal" onclick="closeNewClientModal()">&times;</button>
            </div>
            <form id="new-client-form">
                <div class="form-group">
                    <label>Nome</label>
                    <input type="text" id="new-client-name" required>
                </div>
                <div class="form-group">
                    <label>CPF (Opcional)</label>
                    <input type="text" id="new-client-cpf" oninput="maskCPF(this)">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeNewClientModal()">Cancelar</button>
                    <button type="submit" class="btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ========== MODAL DE PRODUTO (NOVO) ========== -->
    <div id="product-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2 id="product-form-title"><i class="ph ph-plus-circle"></i> Novo Produto</h2>
                <button class="close-modal" onclick="closeProductModal()">&times;</button>
            </div>

            <form id="product-form">
                <input type="hidden" id="product-id">

                <div class="form-group">
                    <label>Código de Barras</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="text" id="product-barcode" required>
                        <button type="button" class="btn-secondary" onclick="generateBarcode()" title="Gerar Código">
                            <i class="ph ph-barcode"></i>
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label>Nome do Produto</label>
                    <input type="text" id="product-name" required>
                </div>

                <div class="form-group">
                    <label>Categoria</label>
                    <select id="product-category" required>
                        <option value="Geral">Geral</option>
                        <option value="Alimentos">Alimentos</option>
                        <option value="Bebidas">Bebidas</option>
                        <option value="Limpeza">Limpeza</option>
                        <option value="Higiene">Higiene</option>
                        <option value="Hortifruti">Hortifruti</option>
                        <option value="Padaria">Padaria</option>
                        <option value="Açougue">Açougue</option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Preço de Custo (R$)</label>
                        <input type="number" id="product-cost-price" step="0.01" min="0.01"
                            oninput="calculateSellingPrice()">
                    </div>
                    <div class="form-group">
                        <label>Margem de Lucro (%)</label>
                        <input type="number" id="product-profit-margin" step="0.01" min="0"
                            oninput="calculateSellingPrice()">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Preço de Venda (R$)</label>
                        <input type="number" id="product-price" step="0.01" min="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Estoque Inicial</label>
                        <input type="number" id="product-stock" min="0" required>
                    </div>
                </div>

                <div class="form-group">
                    <label><i class="ph ph-star"></i> Pontos de Fidelidade (LP)</label>
                    <input type="number" id="product-loyalty-points" min="0" placeholder="0" value="0">
                    <small style="color: var(--text-secondary);">Pontos ganhos ao comprar este produto.</small>
                </div>

                <div class="form-group" style="flex-direction: row; align-items: center; gap: 10px; margin-top: 1rem;">
                    <input type="checkbox" id="product-is-promotion" style="width: auto; margin: 0;"
                        onchange="togglePromotionField()">
                    <label for="product-is-promotion" style="margin: 0; cursor: pointer;">Em Promoção?</label>
                </div>
                <div class="form-group" id="product-promotion-price-group" style="display: none;">
                    <label>Preço Promocional (R$)</label>
                    <input type="number" id="product-promotion-price" step="0.01" min="0.01">
                </div>

                <div class="form-group">
                    <label>Imagem do Produto</label>
                    <input type="file" id="product-image" accept="image/*" onchange="previewImage(this)">
                    <div id="image-preview-container" style="display: none; margin-top: 10px;">
                        <img id="image-preview" src="" alt="Preview"
                            style="max-width: 100%; max-height: 200px; border-radius: 8px;">
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeProductModal()">Cancelar</button>
                    <button type="submit" class="btn-primary">Salvar Produto</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ========== MODAL MEUS PONTOS (CLIENTE) ========== -->
    <div id="loyalty-modal" class="modal-overlay" style="display: none; z-index: 3000;">
        <div class="modal-content" style="max-width: 350px; text-align: center;">
            <div class="modal-header" style="justify-content: center; position: relative;">
                <h2 style="color: var(--accent-orange);"><i class="ph ph-star-fill"></i> Meus Pontos</h2>
                <button class="close-modal" onclick="closeLoyaltyModal()"
                    style="position: absolute; right: 0;">&times;</button>
            </div>

            <div style="margin: 2rem 0;">
                <div style="font-size: 1rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Saldo Atual</div>
                <div id="loyalty-balance-display"
                    style="font-size: 3.5rem; font-weight: 800; color: var(--text-primary); line-height: 1;">0</div>
                <div style="font-size: 1.2rem; font-weight: bold; color: var(--accent-orange);">LP</div>
            </div>

            <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 12px; margin-bottom: 2rem;">
                <div style="font-size: 0.9rem; color: var(--text-secondary);">Valor para Resgate</div>
                <div id="loyalty-value-display" style="font-size: 1.8rem; font-weight: bold; color: var(--success);">R$
                    0,00</div>
            </div>

            <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1.5rem;">
                Use seus pontos para pagar compras na loja!
                <br>1 LP = R$ 0,01
            </p>

            <button class="btn-primary" onclick="closeLoyaltyModal()" style="width: 100%;">Entendi</button>
        </div>
    </div>


    <script src="/js/qrcode.js?v=5.1.0"></script>
    <!-- ========== MODAL PIX CLIENTE ========== -->
    <div id="client-pix-modal" class="modal-overlay" style="display: none; z-index: 2000;">
        <div class="modal-content" style="max-width: 400px; text-align: center;">
            <div class="modal-header">
                <h2><i class="ph ph-qr-code"></i> Pagamento PIX</h2>
                <button class="close-modal" onclick="closeClientPixModal()">&times;</button>
            </div>
            <div style="margin: 20px 0;">
                <p style="color: var(--text-secondary); margin-bottom: 10px;">Chave PIX da Loja:</p>
                <div id="client-pix-key-display"
                    style="font-size: 1.2rem; font-weight: bold; color: var(--accent-green); margin-bottom: 20px; user-select: all;">
                </div>

                <div id="client-pix-qr"
                    style="background: white; padding: 10px; border-radius: 8px; display: inline-block;"></div>
            </div>
            <div class="modal-actions" style="flex-direction: column; gap: 10px;">
                <button class="btn-primary" onclick="openDeliveryModal()"
                    style="width: 100%; padding: 15px; font-size: 1.1rem;">
                    <i class="ph ph-check-circle"></i> Já fiz o pagamento
                </button>
                <button class="btn-secondary" onclick="closeClientPixModal()" style="width: 100%;">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- ========== MODAL DE SELEÇÃO DE ENTREGA ========== -->
    <div id="delivery-selection-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="text-align: center;">
            <div class="modal-header">
                <h3><i class="ph ph-truck"></i> Como deseja receber?</h3>
                <button class="btn-close" onclick="closeDeliveryModal()"><i class="ph ph-x"></i></button>
            </div>
            <div class="modal-body" style="display: flex; flex-direction: column; gap: 15px; margin-top: 20px;">
                <button class="btn-primary" onclick="selectDeliveryMethod('delivery')"
                    style="padding: 20px; font-size: 1.1rem;">
                    <i class="ph ph-moped" style="font-size: 1.5rem; margin-right: 10px;"></i>
                    Quero Receber (Delivery)
                </button>
                <button class="btn-secondary" onclick="selectDeliveryMethod('pickup')"
                    style="padding: 20px; font-size: 1.1rem;">
                    <i class="ph ph-storefront" style="font-size: 1.5rem; margin-right: 10px;"></i>
                    Vou Pegar na Loja (Retirada)
                </button>
            </div>
        </div>
    </div>

    <!-- ========== MODAL DE ENVIO DE COMPROVANTE ========== -->
    <div id="proof-upload-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="ph ph-camera"></i> Enviar Comprovante</h3>
                <button class="btn-close" onclick="closeProofModal()"><i class="ph ph-x"></i></button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 15px; color: var(--text-secondary);">Por favor, envie uma foto do comprovante
                    de pagamento PIX para finalizar seu pedido.</p>

                <div class="form-group">
                    <label>Foto do Comprovante</label>
                    <input type="file" id="proof-image-input" accept="image/*" onchange="previewProofImage(this)">
                </div>

                <div id="proof-preview-container" style="display: none; margin-top: 10px; text-align: center;">
                    <img id="proof-preview" src="" alt="Prévia do Comprovante"
                        style="max-width: 100%; max-height: 300px; border-radius: 8px; border: 1px solid var(--border-color);">
                </div>

            </div>

            <form id="product-form">
                <input type="hidden" id="product-id">

                <div class="form-group">
                    <label>Código de Barras</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="text" id="product-barcode" required>
                        <button type="button" class="btn-secondary" onclick="generateBarcode()" title="Gerar Código">
                            <i class="ph ph-barcode"></i>
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label>Nome do Produto</label>
                    <input type="text" id="product-name" required>
                </div>

                <div class="form-group">
                    <label>Categoria</label>
                    <select id="product-category" required>
                        <option value="Geral">Geral</option>
                        <option value="Alimentos">Alimentos</option>
                        <option value="Bebidas">Bebidas</option>
                        <option value="Limpeza">Limpeza</option>
                        <option value="Higiene">Higiene</option>
                        <option value="Hortifruti">Hortifruti</option>
                        <option value="Padaria">Padaria</option>
                        <option value="Açougue">Açougue</option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Preço de Custo (R$)</label>
                        <input type="number" id="product-cost-price" step="0.01" min="0.01"
                            oninput="calculateSellingPrice()">
                    </div>
                    <div class="form-group">
                        <label>Margem de Lucro (%)</label>
                        <input type="number" id="product-profit-margin" step="0.01" min="0"
                            oninput="calculateSellingPrice()">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Preço de Venda (R$)</label>
                        <input type="number" id="product-price" step="0.01" min="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Estoque Inicial</label>
                        <input type="number" id="product-stock" min="0" required>
                    </div>
                </div>

                <div class="form-group">
                    <label><i class="ph ph-star"></i> Pontos de Fidelidade (LP)</label>
                    <input type="number" id="product-loyalty-points" min="0" placeholder="0" value="0">
                    <small style="color: var(--text-secondary);">Pontos ganhos ao comprar este produto.</small>
                </div>

                <div class="form-group" style="flex-direction: row; align-items: center; gap: 10px; margin-top: 1rem;">
                    <input type="checkbox" id="product-is-promotion" style="width: auto; margin: 0;"
                        onchange="togglePromotionField()">
                    <label for="product-is-promotion" style="margin: 0; cursor: pointer;">Em Promoção?</label>
                </div>
                <div class="form-group" id="product-promotion-price-group" style="display: none;">
                    <label>Preço Promocional (R$)</label>
                    <input type="number" id="product-promotion-price" step="0.01" min="0.01">
                </div>

                <div class="form-group">
                    <label>Imagem do Produto</label>
                    <input type="file" id="product-image" accept="image/*" onchange="previewImage(this)">
                    <div id="image-preview-container" style="display: none; margin-top: 10px;">
                        <img id="image-preview" src="" alt="Preview"
                            style="max-width: 100%; max-height: 200px; border-radius: 8px;">
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeProductModal()">Cancelar</button>
                    <button type="submit" class="btn-primary">Salvar Produto</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ========== MODAL MEUS PONTOS (CLIENTE) ========== -->
    <div id="loyalty-modal" class="modal-overlay" style="display: none; z-index: 3000;">
        <div class="modal-content" style="max-width: 350px; text-align: center;">
            <div class="modal-header" style="justify-content: center; position: relative;">
                <h2 style="color: var(--accent-orange);"><i class="ph ph-star-fill"></i> Meus Pontos</h2>
                <button class="close-modal" onclick="closeLoyaltyModal()"
                    style="position: absolute; right: 0;">&times;</button>
            </div>

            <div style="margin: 2rem 0;">
                <div style="font-size: 1rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Saldo Atual</div>
                <div id="loyalty-balance-display"
                    style="font-size: 3.5rem; font-weight: 800; color: var(--text-primary); line-height: 1;">0</div>
                <div style="font-size: 1.2rem; font-weight: bold; color: var(--accent-orange);">LP</div>
            </div>

            <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 12px; margin-bottom: 2rem;">
                <div style="font-size: 0.9rem; color: var(--text-secondary);">Valor para Resgate</div>
                <div id="loyalty-value-display" style="font-size: 1.8rem; font-weight: bold; color: var(--success);">R$
                    0,00</div>
            </div>

            <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1.5rem;">
                Use seus pontos para pagar compras na loja!
                <br>1 LP = R$ 0,01
            </p>

            <button class="btn-primary" onclick="closeLoyaltyModal()" style="width: 100%;">Entendi</button>
        </div>
    </div>


    <script src="/js/qrcode.js?v=5.1.0"></script>
    <!-- ========== MODAL PIX CLIENTE ========== -->
    <div id="client-pix-modal" class="modal-overlay" style="display: none; z-index: 2000;">
        <div class="modal-content" style="max-width: 400px; text-align: center;">
            <div class="modal-header">
                <h2><i class="ph ph-qr-code"></i> Pagamento PIX</h2>
                <button class="close-modal" onclick="closeClientPixModal()">&times;</button>
            </div>
            <div style="margin: 20px 0;">
                <p style="color: var(--text-secondary); margin-bottom: 10px;">Chave PIX da Loja:</p>
                <div id="client-pix-key-display"
                    style="font-size: 1.2rem; font-weight: bold; color: var(--accent-green); margin-bottom: 20px; user-select: all;">
                </div>

                <div id="client-pix-qr"
                    style="background: white; padding: 10px; border-radius: 8px; display: inline-block;"></div>
            </div>
            <div class="modal-actions" style="flex-direction: column; gap: 10px;">
                <button class="btn-primary" onclick="openDeliveryModal()"
                    style="width: 100%; padding: 15px; font-size: 1.1rem;">
                    <i class="ph ph-check-circle"></i> Já fiz o pagamento
                </button>
                <button class="btn-secondary" onclick="closeClientPixModal()" style="width: 100%;">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- ========== MODAL DE SELEÇÃO DE ENTREGA ========== -->
    <div id="delivery-selection-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="text-align: center;">
            <div class="modal-header">
                <h3><i class="ph ph-truck"></i> Como deseja receber?</h3>
                <button class="btn-close" onclick="closeDeliveryModal()"><i class="ph ph-x"></i></button>
            </div>
            <div class="modal-body" style="display: flex; flex-direction: column; gap: 15px; margin-top: 20px;">
                <button class="btn-primary" onclick="selectDeliveryMethod('delivery')"
                    style="padding: 20px; font-size: 1.1rem;">
                    <i class="ph ph-moped" style="font-size: 1.5rem; margin-right: 10px;"></i>
                    Quero Receber (Delivery)
                </button>
                <button class="btn-secondary" onclick="selectDeliveryMethod('pickup')"
                    style="padding: 20px; font-size: 1.1rem;">
                    <i class="ph ph-storefront" style="font-size: 1.5rem; margin-right: 10px;"></i>
                    Vou Pegar na Loja (Retirada)
                </button>
            </div>
        </div>
    </div>

    <!-- ========== MODAL DE ENVIO DE COMPROVANTE ========== -->
    <div id="proof-upload-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="ph ph-camera"></i> Enviar Comprovante</h3>
                <button class="btn-close" onclick="closeProofModal()"><i class="ph ph-x"></i></button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 15px; color: var(--text-secondary);">Por favor, envie uma foto do comprovante
                    de pagamento PIX para finalizar seu pedido.</p>

                <div class="form-group">
                    <label>Foto do Comprovante</label>
                    <input type="file" id="proof-image-input" accept="image/*" onchange="previewProofImage(this)">
                </div>

                <div id="proof-preview-container" style="display: none; margin-top: 10px; text-align: center;">
                    <img id="proof-preview" src="" alt="Prévia do Comprovante"
                        style="max-width: 100%; max-height: 300px; border-radius: 8px; border: 1px solid var(--border-color);">
                </div>

                <div class="modal-actions" style="margin-top: 20px;">
                    <button class="btn-secondary" onclick="closeProofModal()">Cancelar</button>
                    <button class="btn-primary" onclick="submitOrderWithProof()">
                        <i class="ph ph-check-circle"></i> Finalizar Pedido
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== NOTIFICAÇÃO DE NOVO PEDIDO ==================== -->
    <div id="new-order-notification" onclick="openOrderApprovalModal()"
        style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.95); padding: 2rem; border-radius: 16px; border: 2px solid var(--accent-color); z-index: 9999; cursor: pointer; text-align: center; box-shadow: 0 0 50px rgba(16, 185, 129, 0.5); animation: pulse 2s infinite;">
        <div style="font-size: 4rem; color: var(--accent-color); margin-bottom: 1rem;">
            <i class="ph ph-bell-ringing"></i>
        </div>
        <h2 style="color: white; margin-bottom: 0.5rem; font-size: 2rem;">Novo Pedido!</h2>
        <p style="color: var(--text-secondary); font-size: 1.2rem;">Clique para visualizar e aprovar</p>
    </div>

    <!-- ==================== MODAL DE APROVAÇÃO DE PEDIDO ==================== -->
    <div id="order-approval-modal" class="modal-overlay" style="display: none;">
        <div class="modal w-large">
            <div class="modal-header">
                <h2><i class="ph ph-check-circle"></i> Aprovar Pedido</h2>
                <button class="icon-btn" onclick="closeOrderApprovalModal()"><i class="ph ph-x"></i></button>
            </div>

            <div class="modal-body" style="display: flex; gap: 2rem; flex-wrap: wrap;">
                <!-- Coluna Esquerda: Comprovante -->
                <div style="flex: 1; min-width: 300px;">
                    <h3 style="margin-bottom: 1rem;">Comprovante de Pagamento</h3>
                    <div style="background: #0f1115; padding: 10px; border-radius: 8px; text-align: center;">
                        <img id="approval-proof-image" src="" alt="Comprovante"
                            style="max-width: 100%; max-height: 500px; border-radius: 4px; object-fit: contain;">
                        <p id="approval-no-proof" style="display: none; color: var(--text-secondary); padding: 2rem;">
                            Sem imagem de comprovante</p>
                    </div>
                </div>

                <!-- Coluna Direita: Detalhes -->
                <div style="flex: 1; min-width: 300px; display: flex; flex-direction: column;">
                    <div
                        style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem;">
                        <h3 style="margin-bottom: 1rem; color: var(--accent-color);">Detalhes do Cliente</h3>
                        <p><strong>Nome:</strong> <span id="approval-client-name">...</span></p>
                        <p><strong>Total:</strong> <span id="approval-order-total"
                                style="font-size: 1.5rem; font-weight: bold; color: var(--accent-green);">R$ 0,00</span>
                        </p>
                    </div>

                    <div style="flex: 1; overflow-y: auto; max-height: 300px; margin-bottom: 1.5rem;">
                        <h3>Itens do Pedido</h3>
                        <ul id="approval-items-list" style="list-style: none; padding: 0;">
                            <!-- Items populated via JS -->
                        </ul>
                    </div>

                    <div style="display: flex; gap: 10px; margin-top: auto;">
                        <button class="btn-secondary" onclick="rejectCurrentOrder()"
                            style="flex: 1; background: rgba(220, 38, 38, 0.2); color: #ef4444; border: 1px solid #ef4444;">
                            <i class="ph ph-x"></i> Rejeitar
                        </button>
                        <button class="btn-primary" onclick="confirmCurrentOrder()" style="flex: 1;">
                            <i class="ph ph-check"></i> Aprovar Pedido
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- QRCode Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="reports_logic.js"></script>
    <script src="subscription_logic.js"></script>
    <script src="/app.js?v=5.1.0"></script>
</body>

</html>